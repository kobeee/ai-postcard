# AI明信片项目第二阶段开发计划

> **当前状态**: 异步工作流系统已完成并稳定运行  
> **下一目标**: 完整的微信小程序前端和用户功能  
> **预估时间**: 2-3周  
> **更新日期**: 2025-08-23  

## 🎯 第二阶段开发目标

基于已完成的强大异步工作流后端系统，开发完整的微信小程序前端，实现从创意输入到动态明信片分享的完整用户体验。

### 核心目标
1. **完整的微信小程序界面** - 符合微信设计规范的用户界面
2. **异步工作流集成** - 前端与后端异步系统完美对接
3. **用户账户体系** - 微信授权登录和个人作品管理
4. **社交分享功能** - 明信片分享和社交互动

## 📋 详细任务规划

### Phase 2.1: 微信小程序前端界面开发 (1周)

#### 2.1.1. 小程序项目架构搭建
- [ ] **小程序项目初始化**
  - 使用微信开发者工具创建项目
  - 配置 `app.json`、`project.config.json`
  - 设计目录结构和页面架构

- [ ] **UI组件库选择与配置**
  - 评估 WeUI、Vant Weapp、TDesign 等组件库
  - 配置主题色和设计规范
  - 建立可复用的组件系统

#### 2.1.2. 核心页面开发
- [ ] **首页 (pages/index)**
  ```
  功能:
  - 欢迎界面和创作引导
  - 快速创作入口
  - 个人作品预览缩略图
  - 导航菜单
  ```

- [ ] **创作页面 (pages/create)**
  ```
  功能:
  - 心情选择界面 (开心、期待、平静等)
  - 风格选择 (水墨、赛博朋克、极简等)
  - 主题选择 (生日、旅行、节日等)
  - 自由文本输入
  - 地理位置和天气获取 (可选)
  - 提交创作请求
  ```

- [ ] **生成进度页面 (pages/generating)**
  ```
  功能:
  - 实时显示 AI 工作流进度
  - 概念生成 → 文案生成 → 图片生成 → 代码生成
  - 进度条和状态提示
  - 生成过程中的趣味提示
  ```

- [ ] **明信片预览页面 (pages/preview)**
  ```
  功能:
  - web-view 组件渲染 AI 生成的动态明信片
  - 分享功能 (保存图片、分享给好友、朋友圈)
  - 重新生成按钮
  - 保存到个人作品集
  ```

- [ ] **个人中心页面 (pages/profile)**
  ```
  功能:
  - 个人信息显示 (微信头像、昵称)
  - 作品集展示 (网格布局)
  - 设置选项
  - 关于页面链接
  ```

#### 2.1.3. 交互细节完善
- [ ] **动画和过渡效果**
  - 页面切换动画
  - 按钮点击反馈
  - 加载状态动画
  - 图片加载渐显

- [ ] **错误处理和提示**
  - 网络异常提示
  - 生成失败重试机制
  - 用户友好的错误信息
  - 离线状态处理

### Phase 2.2: 后端集成与API对接 (4-5天)

#### 2.2.1. Gateway Service 适配
- [ ] **小程序专用API路由**
  ```javascript
  // API 路由设计
  POST /api/v1/miniprogram/postcards/create
  GET  /api/v1/miniprogram/postcards/status/:taskId
  GET  /api/v1/miniprogram/postcards/result/:taskId
  POST /api/v1/miniprogram/auth/login
  ```

- [ ] **微信登录集成**
  ```javascript
  // 微信 OAuth 流程
  1. 小程序获取 code
  2. 后端用 code 换取 session_key 和 openid
  3. 生成 JWT token 返回给小程序
  4. 小程序携带 token 进行后续请求
  ```

#### 2.2.2. 用户系统完善
- [ ] **用户数据模型扩展**
  ```sql
  ALTER TABLE users ADD COLUMN open_id VARCHAR(255) UNIQUE;
  ALTER TABLE users ADD COLUMN session_key VARCHAR(255);
  ALTER TABLE users ADD COLUMN union_id VARCHAR(255);
  ALTER TABLE users ADD COLUMN miniprogram_info JSON;
  ```

- [ ] **用户服务API开发**
  - 微信授权登录接口
  - 用户信息更新接口
  - 用户作品列表接口
  - 用户作品详情接口

#### 2.2.3. 小程序端集成开发
- [ ] **HTTP请求封装**
  ```javascript
  // utils/request.js - 统一请求处理
  - 自动携带认证 token
  - 请求和响应拦截器
  - 错误状态码统一处理
  - 加载状态管理
  ```

- [ ] **异步任务状态轮询**
  ```javascript
  // utils/pollTask.js - 任务状态查询
  - 智能轮询策略 (指数退避)
  - 进度状态解析和显示
  - 任务完成/失败处理
  - 自动重试机制
  ```

### Phase 2.3: 用户体验优化 (2-3天)

#### 2.3.1. 性能优化
- [ ] **小程序包体积优化**
  - 图片资源压缩和 CDN 部署
  - 分包加载策略
  - 无用代码清理
  - 组件按需加载

- [ ] **用户体验优化**
  - 预加载关键页面
  - 骨架屏设计
  - 图片懒加载
  - 缓存策略设计

#### 2.3.2. 社交功能开发
- [ ] **分享功能实现**
  ```javascript
  // 分享方案
  1. 生成明信片截图 (canvas API)
  2. 小程序分享 (onShareAppMessage)
  3. 朋友圈分享 (onShareTimeline)
  4. 保存到相册 (saveImageToPhotosAlbum)
  ```

- [ ] **作品集管理**
  - 作品网格展示
  - 作品详情查看
  - 作品删除功能
  - 作品分享统计

## 🏗️ 技术架构设计

### 微信小程序架构
```
miniprogram/
├── pages/              # 页面
│   ├── index/         # 首页
│   ├── create/        # 创作页面
│   ├── generating/    # 生成进度页面
│   ├── preview/       # 明信片预览
│   └── profile/       # 个人中心
├── components/        # 自定义组件
│   ├── mood-selector/ # 心情选择器
│   ├── style-picker/  # 风格选择器
│   └── progress-bar/  # 进度条组件
├── utils/             # 工具函数
│   ├── request.js     # HTTP 请求封装
│   ├── auth.js        # 认证相关
│   └── pollTask.js    # 任务轮询
├── styles/           # 全局样式
└── app.js/json/wxss  # 应用配置
```

### API设计规范
```javascript
// 统一响应格式
{
  "code": 0,           // 0-成功, 非0-失败
  "message": "success", // 响应消息
  "data": {...}        // 实际数据
}

// 任务状态响应
{
  "taskId": "uuid",
  "status": "processing", // pending/processing/completed/failed
  "progress": {
    "step": "image_generation",
    "stepName": "图片生成中",
    "percentage": 75
  },
  "result": {
    "concept": "...",
    "content": "...",
    "imageUrl": "...",
    "frontendCode": "..."
  }
}
```

### 状态管理设计
```javascript
// app.js 全局状态管理
App({
  globalData: {
    userInfo: null,
    token: null,
    currentTask: null,
    generatedPostcards: []
  }
})
```

## 📊 关键指标和验收标准

### 功能验收标准
- [ ] **用户流程完整性**: 从登录→创作→生成→预览→分享的完整闭环
- [ ] **异步任务集成**: 前端能正确显示后端异步工作流的各个阶段
- [ ] **明信片渲染**: web-view 能完美渲染 AI 生成的动态明信片代码
- [ ] **微信集成**: 登录、分享、保存等微信API集成完善

### 性能标准
- [ ] **页面加载时间**: 关键页面2秒内完成首屏渲染
- [ ] **任务创建响应**: 明信片创建请求500ms内返回taskId
- [ ] **包体积控制**: 主包 < 2MB, 总体积 < 8MB
- [ ] **网络容错**: 离线状态和网络异常有友好提示

### 用户体验标准
- [ ] **界面美观**: 符合微信设计规范，视觉统一
- [ ] **操作流畅**: 动画过渡自然，无明显卡顿
- [ ] **错误处理**: 异常情况有明确提示和解决方案
- [ ] **无障碍**: 支持常见的无障碍访问需求

## 🔧 开发环境和工具

### 必需工具
- **微信开发者工具** - 小程序开发和调试
- **微信公众平台** - 小程序注册和配置
- **测试微信号** - 真机测试
- **设计工具** - Figma/Sketch 界面设计

### 技术栈选择
- **前端框架**: 原生微信小程序 + 自定义组件
- **UI组件库**: Vant Weapp (考虑性能和定制性)
- **状态管理**: 全局 globalData + 页面 data
- **网络请求**: 封装的 wx.request
- **图片处理**: 小程序 Canvas API

## 📅 时间节点规划

### Week 1: 微信小程序前端界面
- **Day 1-2**: 项目搭建、UI组件库配置
- **Day 3-4**: 核心页面开发 (首页、创作页)
- **Day 5-7**: 生成进度页、预览页、个人中心页

### Week 2: 后端集成与API对接  
- **Day 1-2**: Gateway Service 小程序API适配
- **Day 3**: 用户系统和微信登录集成
- **Day 4-5**: 小程序端HTTP请求和状态轮询实现

### Week 3: 优化与测试
- **Day 1-2**: 用户体验优化、性能调试
- **Day 3**: 社交功能实现 (分享、作品集)
- **Day 4-5**: 完整功能测试、bug修复

## 🚀 预期成果

### 最终交付物
1. **完整的微信小程序** - 可发布到微信小程序平台
2. **用户账户系统** - 支持微信授权登录和个人作品管理
3. **动态明信片展示** - 完美展示AI生成的交互式明信片
4. **社交分享功能** - 支持多种分享方式和作品收藏

### 技术创新亮点
1. **AI前端编程集成** - 小程序内展示AI编程能力
2. **异步工作流可视化** - 实时展示AI工作流进度
3. **动态内容渲染** - web-view展示动态交互内容
4. **用户创意表达** - 个性化创意到技术实现的完整闭环

**项目价值**: 完成这个阶段后，AI明信片将成为一个完整可用的创新产品，用户能够通过简单的创意输入获得独一无二的动态明信片，体验到AI编程的强大魅力。