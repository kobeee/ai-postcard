# =============================================================================
# AI 明信片项目 - 环境配置模板
# =============================================================================
# 使用说明：
# 1. 复制此文件为 .env：cp .env.example .env
# 2. 根据实际环境修改下面的配置值
# 3. .env 文件已在 .gitignore 中排除，不会被提交到版本控制

# =============================================================================
# 数据库配置 (PostgreSQL)
# =============================================================================
DB_NAME=ai_postcard
DB_USER=postgres
DB_PASSWORD=postgres
DB_HOST=postgres
DB_PORT=5432

# 生产环境建议使用更安全的密码
# DB_PASSWORD=your_secure_password_here

# =============================================================================
# 缓存配置 (Redis)
# =============================================================================
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=redis
REDIS_URL=redis://redis:6379

# 生产环境建议使用更安全的密码
# REDIS_PASSWORD=your_secure_redis_password

# =============================================================================
# AI 服务配置
# =============================================================================
# AI API 密钥 (根据使用的 AI 服务商配置)
AI_API_KEY=your_ai_api_key_here

# AI 服务基础 URL (可选，如使用自定义端点)
AI_BASE_URL=https://api.openai.com/v1

# AI 模型配置
AI_MODEL=gpt-3.5-turbo
AI_MAX_TOKENS=2000
AI_TEMPERATURE=0.7

# =============================================================================
# 微信小程序配置
# =============================================================================
# 微信小程序 AppID
WECHAT_APP_ID=

# 微信小程序 AppSecret
WECHAT_APP_SECRET=

# =============================================================================
# 应用配置
# =============================================================================
# 应用环境 (development, staging, production)
NODE_ENV=development
APP_ENV=development

# 业务时区（用于“每日配额”重置等逻辑），默认中国时区
# 可选示例：Asia/Shanghai, UTC, America/Los_Angeles
APP_TIMEZONE=Asia/Shanghai

# 应用密钥 (用于 JWT 签名等)
APP_SECRET=your_app_secret_key_here

# API 网关配置
GATEWAY_PORT=8080
GATEWAY_HOST=0.0.0.0

# =============================================================================
# 文件存储配置
# =============================================================================
# 本地文件存储路径
UPLOAD_PATH=./uploads
MAX_FILE_SIZE=10485760

# 云存储配置 (可选)
# CLOUD_STORAGE_TYPE=aliyun_oss
# CLOUD_STORAGE_BUCKET=your-bucket-name
# CLOUD_STORAGE_REGION=oss-cn-hangzhou
# CLOUD_STORAGE_ACCESS_KEY=your_access_key
# CLOUD_STORAGE_SECRET_KEY=your_secret_key

# =============================================================================
# 日志配置
# =============================================================================
LOG_LEVEL=info
LOG_FORMAT=combined

# 宿主机目录属主属组（用于生产容器非root写入 bind 挂载目录）
# 一般设置为部署机上你希望写入 logs/ 与 data/ 的用户/组 UID、GID
# 缺省为 1000:1000
APP_UID=1000
APP_GID=1000

# =============================================================================
# 开发环境专用配置
# =============================================================================
# 是否启用调试模式
DEBUG=true

# 是否启用热重载
HOT_RELOAD=true

# 开发服务器端口配置
GATEWAY_DEV_PORT=8080
USER_SERVICE_DEV_PORT=8081
POSTCARD_SERVICE_DEV_PORT=8082
AI_AGENT_SERVICE_DEV_PORT=8001

# =============================================================================
# 邮件服务配置 (可选)
# =============================================================================
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_USER=your_email@gmail.com
# SMTP_PASS=your_app_password
# SMTP_FROM=your_email@gmail.com

# =============================================================================
# 监控配置 (可选)
# =============================================================================
# SENTRY_DSN=your_sentry_dsn_here
# PROMETHEUS_PORT=9090

# =============================================================================
# AI Agent Service Provider 配置 (核心)
# =============================================================================
# --- Provider 路由 ---
# 决定使用哪个 AI Provider, 'claude' 是我们初期的重点
AI_PROVIDER_TYPE=claude

# --- Claude Provider ---
# 官方 SDK 使用的环境变量，用于 API 鉴权，必须填写
ANTHROPIC_AUTH_TOKEN=
# API 的基础 URL，如使用代理或第三方端点时填写
ANTHROPIC_BASE_URL=
# 默认使用的模型
CLAUDE_DEFAULT_MODEL=claude-sonnet-4-20250514
# 备用模型，例如 K2，根据需要填写
CLAUDE_FALLBACK_MODEL=

# --- Gemini Provider (生图和生文功能) ---
# Gemini API 密钥，用于文本生成和图片生成
GEMINI_API_KEY=
# Gemini API 基础 URL，可选，如使用代理时填写
GEMINI_BASE_URL=https://generativelanguage.googleapis.com
# 文本生成默认模型
GEMINI_TEXT_MODEL=gemini-2.5-flash-lite
# 图片生成默认模型  
GEMINI_IMAGE_MODEL=gemini-2.0-flash-preview-image-generation
GEMINI_IMAGE_STRICT=true
# 文本生成配置
GEMINI_TEXT_MAX_TOKENS=2048
GEMINI_TEXT_TEMPERATURE=0.7
# 图片生成配置
GEMINI_IMAGE_SIZE=1024x1024
GEMINI_IMAGE_QUALITY=standard

# 是否启用严格模式（严格调用真实API）
LAO_ZHANG_IMAGE_STRICT=false
# --- 图片生成 Provider 选择 ---
# 指定使用哪个图片生成 Provider: 'gemini' 或 'laozhang'
IMAGE_PROVIDER_TYPE=gemini

# =============================================================================
# 异步工作流配置
# =============================================================================
# 明信片服务配置  
POSTCARD_SERVICE_URL=http://postcard-service:8000

# AI工作流配置
AI_WORKFLOW_TIMEOUT=300  # 5分钟超时
AI_WORKFLOW_RETRY_COUNT=3

# 消息队列配置
QUEUE_STREAM_NAME=postcard_tasks
QUEUE_CONSUMER_GROUP=ai_agent_workers

# =============================================================================
# 时事热点新闻查询配置
# =============================================================================
# GNEWS key
GNEWS_API_KEY=

# 对外可访问的 AI Agent Public URL（用于拼接 HTML→Image 链接返回给小程序）
AI_AGENT_PUBLIC_URL=

# =============================================================================
# 安全升级配置 - 简化版本 (v2.0)
# =============================================================================

# JWT 认证配置
SECURITY_JWT_ENABLED=true
JWT_SECRET_KEY=your_jwt_secret_key_change_in_production_must_be_very_long_and_secure

# 跨服务调用内部令牌（用于AI Agent等内部服务访问postcard-service内部API）
INTERNAL_SERVICE_TOKEN=please_change_this_internal_token
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=60
JWT_REFRESH_TOKEN_EXPIRE_DAYS=30

# RBAC 权限配置
SECURITY_RBAC_ENABLED=true
DEFAULT_USER_ROLE=user

# API 安全配置
SECURITY_RATE_LIMITING_ENABLED=true
RATE_LIMIT_GLOBAL_PER_MINUTE=1000
RATE_LIMIT_USER_PER_MINUTE=100

SECURITY_INPUT_VALIDATION_ENABLED=true
INPUT_MAX_LENGTH=10000

# 并发控制配置
SECURITY_CONCURRENT_QUOTA_ENABLED=true
DISTRIBUTED_LOCKS_ENABLED=true
OPTIMISTIC_LOCKING_ENABLED=true

# 审计日志配置  
SECURITY_AUDIT_LOGGING_ENABLED=true
AUDIT_STORE_IN_DB=true
AUDIT_STORE_IN_REDIS=true

# 安全监控配置
SECURITY_MONITORING_ENABLED=true
PERFORMANCE_MONITORING_ENABLED=true

# Redis 数据库分配 (保持现有配置)
REDIS_DB=0  # 默认数据库


# =============================================================================
# AI工作流优化配置 (新增)
# =============================================================================
# AI工作流版本控制
WORKFLOW_VERSION=unified  # "unified" | "legacy"

# Gemini优化配置  
GEMINI_RETRY_MAX_ATTEMPTS=3
GEMINI_RETRY_DELAYS=1,3,5  # 秒

# 签体配置路径
CHARM_CONFIG_PATH=/app/resources/签体/charm-config.json
