<!-- ç»“æ„åŒ–æ˜ä¿¡ç‰‡ç»„ä»¶æ¨¡æ¿ - é‡æ„åçš„5å±‚æ¶æ„ -->

<!-- ç¬¬1å±‚ï¼šé€è§†å®¹å™¨ -->
<view class="card-scene" style="{{containerStyle}}">
  
  <!-- ç¬¬2å±‚ï¼šç¿»è½¬æ§åˆ¶å™¨ -->
  <view class="card-flipper {{isFlipped ? 'flipped' : ''}}" bindtap="onCardTap">
    
    <!-- ç¬¬3å±‚ï¼šæ­£é¢å®¹å™¨ -->
    <view class="card-face card-face-front">
      <!-- ç¬¬4å±‚ï¼šè§†è§‰å¤–å£³ï¼ˆå¤„ç†åŠ¨ç”»ã€é˜´å½±ã€èƒŒæ™¯ï¼‰ -->
      <view class="postcard-shell {{isAnimating ? 'animated' : ''}}" 
            style="{{dynamicCardStyle}}" 
            animation="{{animationData}}">
        
        <!-- èƒŒæ™¯å›¾ç‰‡å±‚ -->
        <image 
          class="background-image" 
          src="{{backgroundImage}}" 
          mode="aspectFill"
          lazy-load="true"
          wx:if="{{backgroundImage}}"
        ></image>
        
        <!-- ç¬¬5å±‚ï¼šå†…å®¹å±‚ -->
        <view class="postcard-content" style="{{dynamicContentStyle}}">
          
          <!-- æ ‡é¢˜åŒºåŸŸ -->
          <view class="header-section">
            <text class="card-title">{{structuredData.title || 'ä»Šæ—¥å¿ƒæƒ…'}}</text>
          </view>
          
          <!-- ä¸»è¦æ–‡æ¡ˆ -->
          <view class="main-content-section">
            <text class="main-text">{{structuredData.content.main_text}}</text>
          </view>
          
          <!-- æ„Ÿå—åˆ†äº« -->
          <view class="feelings-section" wx:if="{{structuredData.content.hot_topics}}">
            <view class="feeling-item" wx:if="{{structuredData.content.hot_topics.xiaohongshu}}">
              <text class="feeling-prefix">Â·</text>
              <text class="feeling-text">{{structuredData.content.hot_topics.xiaohongshu}}</text>
            </view>
            <view class="feeling-item" wx:if="{{structuredData.content.hot_topics.douyin}}">
              <text class="feeling-prefix">Â·</text>
              <text class="feeling-text">{{structuredData.content.hot_topics.douyin}}</text>
            </view>
          </view>
          
          <!-- è‹±æ–‡æµ®æ¡ï¼ˆå¤šæ¥æºå…œåº•ï¼‰ -->
          <view class="quote-section" wx:if="{{hasQuote}}">
            <text class="quote-text">{{quoteText}}</text>
            <text class="quote-author" wx:if="{{quoteAuthor}}">â€” {{quoteAuthor}}</text>
            <text class="quote-translation" wx:if="{{quoteTranslation}}">{{quoteTranslation}}</text>
          </view>
          
          <!-- æ¨èå†…å®¹ -->
          <view class="recommendations-section" wx:if="{{structuredData.recommendations}}">
            <view class="recommendations-header" catchtap="toggleRecommendations">
              <text class="recommendations-title">ä»Šæ—¥æ¨è</text>
              <text class="expand-icon {{recommendationsExpanded ? 'expanded' : ''}}">â–¼</text>
            </view>
            
            <view class="recommendations-content {{recommendationsExpanded ? 'expanded' : ''}}">
              <!-- éŸ³ä¹æ¨è -->
              <view 
                class="recommendation-item music" 
                wx:if="{{hasMusic}}"
                data-type="music"
                data-item="{{recMusic}}"
                catchtap="onRecommendationTap"
              >
                <text class="rec-icon">ğŸµ</text>
                <view class="rec-content">
                  <text class="rec-title">{{recMusic.title}}</text>
                  <text class="rec-subtitle">{{recMusic.artist}}</text>
                  <text class="rec-reason">{{recMusic.reason}}</text>
                </view>
              </view>
              
              <!-- ä¹¦ç±æ¨è -->
              <view 
                class="recommendation-item book" 
                wx:if="{{hasBook}}"
                data-type="book"
                data-item="{{recBook}}"
                catchtap="onRecommendationTap"
              >
                <text class="rec-icon">ğŸ“š</text>
                <view class="rec-content">
                  <text class="rec-title">{{recBook.title}}</text>
                  <text class="rec-subtitle">{{recBook.author}}</text>
                  <text class="rec-reason">{{recBook.reason}}</text>
                </view>
              </view>
              
              <!-- ç”µå½±æ¨è -->
              <view 
                class="recommendation-item movie" 
                wx:if="{{hasMovie}}"
                data-type="movie"
                data-item="{{recMovie}}"
                catchtap="onRecommendationTap"
              >
                <text class="rec-icon">ğŸ¬</text>
                <view class="rec-content">
                  <text class="rec-title">{{recMovie.title}}</text>
                  <text class="rec-subtitle">{{recMovie.director}}</text>
                  <text class="rec-reason">{{recMovie.reason}}</text>
                </view>
              </view>
            </view>
          </view>
          
          <!-- åº•éƒ¨ä¿¡æ¯ï¼šå»æ‰åœ°ç‚¹/å¤©æ°”ï¼Œä»…ä¿ç•™ç¿»è½¬æç¤º -->
          <view class="footer-section">
            <view class="flip-hint">
              <text class="flip-icon">â†»</text>
              <text class="flip-text">ç‚¹å‡»ç¿»è½¬æŸ¥çœ‹è¯¦æƒ…</text>
            </view>
          </view>
          
        </view>
        
        <!-- è£…é¥°æ€§åŠ¨æ•ˆå±‚ -->
        <view class="decoration-layer" wx:if="{{showGradientAnimation}}">
          <view class="gradient-overlay"></view>
        </view>
        
      </view>
    </view>
    
    <!-- ç¬¬3å±‚ï¼šèƒŒé¢å®¹å™¨ -->
    <view class="card-face card-face-back">
      <!-- ç¬¬4å±‚ï¼šè§†è§‰å¤–å£³ï¼ˆèƒŒé¢æ— èƒŒæ™¯å›¾ï¼Œçº¯è‰²èƒŒæ™¯ï¼‰ -->
      <view class="postcard-shell postcard-shell-back">
        
        <!-- ç¬¬5å±‚ï¼šå†…å®¹å±‚ -->
        <view class="postcard-content back-content" style="{{dynamicContentStyle}}">
          
          <!-- èƒŒé¢æ‰©å±•å†…å®¹ï¼ˆè‹¥å­˜åœ¨åˆ™ä¼˜å…ˆæ˜¾ç¤ºï¼‰ -->
          <view class="back-extras" wx:if="{{structuredData.extras}}">
            
            <!-- ä»Šæ—¥åæ€ -->
            <view class="back-block" wx:if="{{structuredData.extras.reflections && structuredData.extras.reflections.length}}">
              <view class="back-item-header">
                <text class="back-icon">ğŸ“</text>
                <text class="back-label">ä»Šæ—¥åæ€</text>
              </view>
              <view class="extras-list">
                <view class="extras-li" wx:for="{{structuredData.extras.reflections}}" wx:key="*this">Â· {{item}}</view>
              </view>
            </view>
            
            <!-- æ„Ÿè°¢æ¸…å• -->
            <view class="back-block" wx:if="{{structuredData.extras.gratitude && structuredData.extras.gratitude.length}}">
              <view class="back-item-header">
                <text class="back-icon">ğŸ™</text>
                <text class="back-label">æ„Ÿè°¢æ¸…å•</text>
              </view>
              <view class="extras-list">
                <view class="extras-li" wx:for="{{structuredData.extras.gratitude}}" wx:key="*this">Â· {{item}}</view>
              </view>
            </view>
            
            <!-- å¾®è¡ŒåŠ¨ -->
            <view class="back-block" wx:if="{{structuredData.extras.micro_actions && structuredData.extras.micro_actions.length}}">
              <view class="back-item-header">
                <text class="back-icon">âœ…</text>
                <text class="back-label">å¾®è¡ŒåŠ¨</text>
              </view>
              <view class="extras-list">
                <view class="extras-li" wx:for="{{structuredData.extras.micro_actions}}" wx:key="*this">Â· {{item}}</view>
              </view>
            </view>
            
            <!-- æƒ…ç»ªå»ºè®® -->
            <view class="back-block" wx:if="{{structuredData.extras.mood_tips && structuredData.extras.mood_tips.length}}">
              <view class="back-item-header">
                <text class="back-icon">ğŸ’¡</text>
                <text class="back-label">æƒ…ç»ªå»ºè®®</text>
              </view>
              <view class="extras-list">
                <view class="extras-li" wx:for="{{structuredData.extras.mood_tips}}" wx:key="*this">Â· {{item}}</view>
              </view>
            </view>
            
            <!-- ç”Ÿæ´»æ„Ÿæ‚Ÿ -->
            <view class="back-block" wx:if="{{structuredData.extras.life_insights && structuredData.extras.life_insights.length}}">
              <view class="back-item-header">
                <text class="back-icon">ğŸŒŸ</text>
                <text class="back-label">ç”Ÿæ´»æ„Ÿæ‚Ÿ</text>
              </view>
              <view class="extras-list">
                <view class="extras-li" wx:for="{{structuredData.extras.life_insights}}" wx:key="*this">Â· {{item}}</view>
              </view>
            </view>
            
            <!-- åˆ›æ„çµæ„Ÿ -->
            <view class="back-block" wx:if="{{structuredData.extras.creative_spark && structuredData.extras.creative_spark.length}}">
              <view class="back-item-header">
                <text class="back-icon">ğŸ’«</text>
                <text class="back-label">åˆ›æ„ç«èŠ±</text>
              </view>
              <view class="extras-list">
                <view class="extras-li" wx:for="{{structuredData.extras.creative_spark}}" wx:key="*this">Â· {{item}}</view>
              </view>
            </view>
            
            <!-- æ­£å¿µè§‰å¯Ÿ -->
            <view class="back-block" wx:if="{{structuredData.extras.mindfulness && structuredData.extras.mindfulness.length}}">
              <view class="back-item-header">
                <text class="back-icon">ğŸ§˜</text>
                <text class="back-label">å½“ä¸‹è§‰å¯Ÿ</text>
              </view>
              <view class="extras-list">
                <view class="extras-li" wx:for="{{structuredData.extras.mindfulness}}" wx:key="*this">Â· {{item}}</view>
              </view>
            </view>
            
            <!-- æœªæ¥æ„¿æ™¯ -->
            <view class="back-block" wx:if="{{structuredData.extras.future_vision && structuredData.extras.future_vision.length}}">
              <view class="back-item-header">
                <text class="back-icon">ğŸŒˆ</text>
                <text class="back-label">æœªæ¥æœŸå¾…</text>
              </view>
              <view class="extras-list">
                <view class="extras-li" wx:for="{{structuredData.extras.future_vision}}" wx:key="*this">Â· {{item}}</view>
              </view>
            </view>
          </view>

          <!-- è¯¦ç»†æ¨èå†…å®¹ï¼ˆå¦‚æœæ²¡æœ‰extrasåˆ™æ˜¾ç¤ºï¼‰ -->
          <view class="back-recommendations" wx:if="{{!structuredData.extras && structuredData.recommendations}}">
            <view class="back-header">
              <text class="back-title">ä»Šæ—¥æ¨èè¯¦æƒ…</text>
            </view>
            
            <!-- éŸ³ä¹æ¨èè¯¦æƒ… -->
            <view class="back-item music-detail" wx:if="{{hasMusic}}">
              <view class="back-item-header">
                <text class="back-icon">ğŸµ</text>
                <text class="back-label">éŸ³ä¹æ¨è</text>
              </view>
              <text class="back-item-title">{{recMusic.title}}</text>
              <text class="back-item-subtitle">{{recMusic.artist}}</text>
              <text class="back-item-reason">{{recMusic.reason}}</text>
            </view>
            
            <!-- ä¹¦ç±æ¨èè¯¦æƒ… -->
            <view class="back-item book-detail" wx:if="{{hasBook}}">
              <view class="back-item-header">
                <text class="back-icon">ğŸ“š</text>
                <text class="back-label">ä¹¦ç±æ¨è</text>
              </view>
              <text class="back-item-title">{{recBook.title}}</text>
              <text class="back-item-subtitle">{{recBook.author}}</text>
              <text class="back-item-reason">{{recBook.reason}}</text>
            </view>
            
            <!-- ç”µå½±æ¨èè¯¦æƒ… -->
            <view class="back-item movie-detail" wx:if="{{hasMovie}}">
              <view class="back-item-header">
                <text class="back-icon">ğŸ¬</text>
                <text class="back-label">ç”µå½±æ¨è</text>
              </view>
              <text class="back-item-title">{{recMovie.title}}</text>
              <text class="back-item-subtitle">{{recMovie.director}}</text>
              <text class="back-item-reason">{{recMovie.reason}}</text>
            </view>
          </view>
          
          <!-- è¡¥å……æ–‡æ¡ˆ -->
          <view class="back-sub-text" wx:if="{{structuredData.content.sub_text}}">
            <text class="sub-text-content">{{structuredData.content.sub_text}}</text>
          </view>
          
          <!-- èƒŒé¢åº•éƒ¨ï¼šåˆ†äº«å’Œè¿”å› -->
          <view class="back-footer">
            <view class="share-button" catchtap="shareCard">
              <text class="share-icon">âœ¨</text>
              <text class="share-text">åˆ†äº«å¿ƒæƒ…</text>
            </view>
            <view class="flip-back-hint">
              <text class="flip-icon">â†º</text>
              <text class="flip-text">ç‚¹å‡»è¿”å›æ­£é¢</text>
            </view>
          </view>
          
        </view>
      </view>
    </view>
    
  </view>
</view>

<!-- éšè—çš„æˆªå›¾Canvas -->
<canvas canvas-id="screenshot-canvas" class="hidden-canvas"></canvas>